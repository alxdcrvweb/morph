import React, { FC, ReactNode, useEffect, useState } from "react";
import { useImageLoader } from "../images/loader";
import styles from "./loader.module.scss";
import cn from "classnames";
import { useRouter } from "next/router";
import { NextPage } from "next";

const AppLoader: FC = ({ children }) => {
  const router = useRouter();
  const routerPath = router.asPath.split(/[/]|[#]/)[1];
  const { loadAll, progress } = useImageLoader();

  const [loaded, setLoaded] = useState(false);

  useEffect(() => {
    loadAll();
  }, []);

  useEffect(() => {
    if (progress == 100) {
      setTimeout(() => {
        setLoaded(true);
      }, 1000);
    }
  }, [progress]);

  return (
    <>
      {!loaded && (
        <div
          className={cn(
            styles.loader,
            routerPath === "terminal" ? styles.loader_terminal : ""
          )}
        >
          <svg
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
            xmlnsXlink="http://www.w3.org/1999/xlink"
            x="0px"
            y="0px"
            viewBox="0 0 500 500"
            xmlSpace="preserve"
          >
            <circle
              className="st0"
              cx="251.44"
              cy="250.76"
              r={progress / 2.1}
            />
            <g>
              {progress >= 10 && (
                <path
                  className="st0"
                  d="M252.75,187.99V138.6c-0.44,0-0.87-0.02-1.31-0.02c-0.44,0-0.87,0.02-1.31,0.02v49.39c0.44-0.01,0.87-0.03,1.31-0.03C251.87,187.95,252.31,187.98,252.75,187.99z"
                />
              )}
              {progress >= 15 && (
                <>
                  <path
                    className="st0"
                    d="M241.82,188.69l-8.62-48.91c-0.87,0.11-1.73,0.24-2.59,0.37l8.64,49C240.1,188.98,240.95,188.82,241.82,188.69z"
                  />
                  <path
                    className="st0"
                    d="M272.27,140.14c-0.86-0.13-1.73-0.26-2.6-0.37l-8.62,48.91c0.87,0.13,1.72,0.29,2.58,0.46L272.27,140.14z"
                  />
                </>
              )}
              {progress >= 20 && (
                <>
                  <path
                    className="st0"
                    d="M231.19,191.31l-17.38-47.75c-0.85,0.22-1.69,0.45-2.54,0.69l17.46,47.96C229.54,191.89,230.36,191.59,231.19,191.31z"
                  />
                  <path
                    className="st0"
                    d="M274.14,192.2l17.46-47.96c-0.84-0.23-1.69-0.47-2.54-0.69l-17.38,47.75C272.51,191.59,273.33,191.89,274.14,192.2z"
                  />
                </>
              )}
              {progress >= 25 && (
                <>
                  <path
                    className="st0"
                    d="M221.17,195.72l-26.54-45.97c-0.82,0.32-1.65,0.63-2.47,0.96l26.74,46.32C219.65,196.57,220.41,196.14,221.17,195.72z"
                  />
                  <path
                    className="st0"
                    d="M283.97,197.03l26.74-46.32c-0.82-0.33-1.65-0.64-2.47-0.96l-26.54,45.97C282.46,196.14,283.22,196.57,283.97,197.03z"
                  />
                </>
              )}
              {progress >= 30 && (
                <>
                  <path
                    className="st0"
                    d="M212.08,201.82l-36.56-43.57c-0.8,0.4-1.59,0.82-2.39,1.23l36.94,44.03C210.74,202.94,211.4,202.37,212.08,201.82z"
                  />
                  <path
                    className="st0"
                    d="M292.79,203.51l36.94-44.03c-0.79-0.41-1.59-0.83-2.39-1.23l-36.56,43.57C291.47,202.37,292.13,202.94,292.79,203.51z"
                  />
                </>
              )}
              {progress >= 35 && (
                <>
                  <path
                    className="st0"
                    d="M204.19,209.4l-47.96-40.24c-0.78,0.49-1.55,0.98-2.32,1.47l48.59,40.77C203.05,210.73,203.61,210.06,204.19,209.4z"
                  />
                  <path
                    className="st0"
                    d="M300.37,211.41l48.59-40.77c-0.77-0.49-1.54-0.99-2.32-1.47l-47.96,40.24C299.26,210.06,299.82,210.73,300.37,211.41z"
                  />
                </>
              )}
              {progress >= 40 && (
                <>
                  <path
                    className="st0"
                    d="M197.7,218.22l-61.34-35.42c-0.76,0.57-1.52,1.14-2.27,1.71l62.31,35.97C196.82,219.73,197.25,218.97,197.7,218.22z"
                  />
                  <path
                    className="st0"
                    d="M306.47,220.49l62.31-35.97c-0.75-0.57-1.51-1.14-2.27-1.71l-61.34,35.42C305.62,218.97,306.05,219.73,306.47,220.49z"
                  />
                </>
              )}
              {progress >= 45 && (
                <>
                  <path
                    className="st0"
                    d="M192.88,228.05l-77.46-28.19c-0.75,0.66-1.48,1.32-2.22,1.98l78.78,28.67C192.27,229.68,192.57,228.86,192.88,228.05z"
                  />
                  <path
                    className="st0"
                    d="M310.89,230.51l78.78-28.67c-0.73-0.66-1.47-1.32-2.22-1.98l-77.46,28.19C310.31,228.86,310.6,229.68,310.89,230.51z"
                  />
                </>
              )}
              {progress >= 50 && (
                <>
                  <path
                    className="st0"
                    d="M189.82,238.56l-96.93-17.09c-0.74,0.77-1.46,1.53-2.17,2.28l98.64,17.39C189.5,240.28,189.66,239.42,189.82,238.56z"
                  />
                  <path
                    className="st0"
                    d="M313.51,241.14l98.64-17.39c-0.71-0.75-1.43-1.51-2.17-2.28l-96.93,17.09C313.21,239.42,313.37,240.28,313.51,241.14z"
                  />
                </>
              )}
              {progress >= 55 && (
                <>
                  <path
                    className="st0"
                    d="M188.63,250.76c0-0.44,0.02-0.87,0.03-1.31H68.58c-0.65,0.85-0.99,1.31-0.99,1.31s0.34,0.46,0.99,1.31h120.08C188.66,251.63,188.63,251.2,188.63,250.76z"
                  />
                  <path
                    className="st0"
                    d="M434.29,249.45H314.21c0.01,0.44,0.03,0.87,0.03,1.31s-0.02,0.87-0.03,1.31h120.08c0.65-0.85,0.99-1.31,0.99-1.31S434.94,250.3,434.29,249.45z"
                  />
                </>
              )}
              {progress >= 60 && (
                <>
                  <path
                    className="st0"
                    d="M189.36,260.37l-98.64,17.39c0.71,0.75,1.43,1.51,2.17,2.28l96.93-17.09C189.66,262.1,189.5,261.24,189.36,260.37z"
                  />
                  <path
                    className="st0"
                    d="M313.05,262.95l96.93,17.09c0.74-0.77,1.46-1.53,2.17-2.28l-98.64-17.39C313.37,261.24,313.21,262.1,313.05,262.95z"
                  />
                </>
              )}
              {progress >= 65 && (
                <>
                  <path
                    className="st0"
                    d="M191.99,271l-78.78,28.67c0.73,0.66,1.47,1.32,2.22,1.98l77.46-28.19C192.57,272.65,192.27,271.83,191.99,271z"
                  />
                  <path
                    className="st0"
                    d="M309.99,273.46l77.46,28.19c0.75-0.66,1.49-1.32,2.22-1.98L310.89,271C310.6,271.83,310.31,272.65,309.99,273.46z"
                  />
                </>
              )}
              {progress >= 70 && (
                <>
                  <path
                    className="st0"
                    d="M196.4,281.02L134.09,317c0.75,0.57,1.51,1.14,2.27,1.71l61.34-35.42C197.25,282.55,196.82,281.79,196.4,281.02z"
                  />
                  <path
                    className="st0"
                    d="M305.17,283.29l61.34,35.42c0.76-0.57,1.52-1.14,2.27-1.71l-62.31-35.97C306.05,281.79,305.62,282.55,305.17,283.29z"
                  />
                </>
              )}
              {progress >= 75 && (
                <>
                  <path
                    className="st0"
                    d="M202.5,290.11l-48.59,40.77c0.77,0.49,1.54,0.99,2.32,1.47l47.96-40.24C203.61,291.45,203.05,290.79,202.5,290.11z"
                  />
                  <path
                    className="st0"
                    d="M298.68,292.11l47.96,40.25c0.78-0.49,1.55-0.98,2.32-1.47l-48.59-40.77C299.82,290.79,299.26,291.45,298.68,292.11z"
                  />
                </>
              )}
              {progress >= 80 && (
                <>
                  <path
                    className="st0"
                    d="M210.08,298l-36.94,44.03c0.79,0.41,1.59,0.83,2.39,1.23l36.56-43.57C211.4,299.14,210.74,298.58,210.08,298z"
                  />
                  <path
                    className="st0"
                    d="M290.79,299.69l36.56,43.57c0.8-0.4,1.59-0.82,2.39-1.23L292.79,298C292.13,298.58,291.47,299.14,290.79,299.69z"
                  />
                </>
              )}
              {progress >= 85 && (
                <>
                  <path
                    className="st0"
                    d="M218.9,304.49l-26.74,46.32c0.82,0.33,1.65,0.64,2.47,0.96l26.54-45.97C220.41,305.37,219.65,304.94,218.9,304.49z"
                  />
                  <path
                    className="st0"
                    d="M281.7,305.79l26.54,45.97c0.82-0.32,1.65-0.63,2.47-0.96l-26.74-46.32C283.22,304.94,282.46,305.37,281.7,305.79z"
                  />
                </>
              )}
              {progress >= 90 && (
                <>
                  <path
                    className="st0"
                    d="M228.73,309.31l-17.46,47.96c0.84,0.23,1.69,0.47,2.54,0.69l17.38-47.75C230.36,309.93,229.54,309.63,228.73,309.31z"
                  />
                  <path
                    className="st0"
                    d="M271.68,310.21l17.38,47.75c0.85-0.22,1.69-0.45,2.54-0.69l-17.46-47.96C273.33,309.63,272.51,309.93,271.68,310.21z"
                  />
                </>
              )}
              {progress >= 95 && (
                <>
                  <path
                    className="st0"
                    d="M230.6,361.37c0.86,0.13,1.73,0.26,2.59,0.37l8.62-48.91c-0.87-0.13-1.72-0.29-2.58-0.46L230.6,361.37z"
                  />
                  <path
                    className="st0"
                    d="M261.05,312.83l8.62,48.91c0.87-0.11,1.73-0.24,2.6-0.37l-8.64-49C262.78,312.54,261.92,312.7,261.05,312.83z"
                  />
                </>
              )}
              {progress >= 100 && (
                <path
                  className="center"
                  d="M250.13,313.53v49.39c0.44,0,0.87,0.02,1.31,0.02c0.44,0,0.87-0.02,1.31-0.02v-49.39c-0.44,0.01-0.87,0.03-1.31,0.03C251,313.56,250.56,313.54,250.13,313.53z"
                />
              )}
            </g>
          </svg>
          {routerPath === "terminal" && (
            <div className={styles.loader__text}>
              The third eye (also called the mindâ€™s eye or inner eye) is a
              mythical and esoteric concept of a speculative invisible eye,
              usually located on the ???????, which provides perception beyond
              ordinary sight
            </div>
          )}
        </div>
      )}
      <div style={{ zIndex: 0 }}>{children}</div>
    </>
  );
};

export default AppLoader;
