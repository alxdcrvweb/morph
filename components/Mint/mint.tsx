import { useEffect, useRef, useState } from "react";
import style from "./mint.module.scss";
import StepTitle from "../FirstSection/Title";
import { observer } from "mobx-react";
import { useInjection } from "inversify-react";
import { ModalStore } from "../../stores/ModalStore";
import { ModalsEnum } from "../../modals";
import Timer from "./timer";
import { Web3Store } from "../../stores/Web3Store";

export const timeToMint = Date.parse("2024-02-26 19:20:00 GMT+0100");
const Mint = observer(() => {
  const [opacity, setOpacity] = useState<boolean>(false);
  const [timerEnd, setTimerEnd] = useState<number>(1);
  const modalStore = useInjection(ModalStore);
  const web3Store = useInjection(Web3Store);
  const openMintModal = () => {
    modalStore.showModal(ModalsEnum.Mint);
  };

  useEffect(() => {
    let interval = setInterval(() => {
      setTimerEnd(Number(timeToMint) - Number(Date.parse(new Date().toString())));
    }, 1000);
    let tt = setTimeout(() => {
      setOpacity(true);
    }, 1000);
    return () => {
      clearInterval(interval);
      clearTimeout(tt);
    };
  }, []);
  return (
    <div className={style.mint__main}>
      <img className={style.mint__second__layer} src="/mintSecondLayer.png" />
      <div className={style.mint__top}>
        <svg
          width="57"
          height="51"
          viewBox="0 0 57 51"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M56.3249 16.7064V16.7064L56.3365 16.8295C56.3365 16.8453 56.3349 16.8673 56.3332 16.8912C56.3311 16.9195 56.3288 16.9505 56.3288 16.9769C56.3237 17.041 56.3129 17.1044 56.2966 17.1666C56.2748 17.2579 56.2438 17.3468 56.204 17.4319L56.1835 17.4832L56.1397 17.5909L56.0523 17.7985C55.9931 17.9344 55.9327 18.0716 55.8722 18.1997C55.75 18.4561 55.6214 18.7125 55.4928 18.9688C55.2296 19.4764 54.9513 19.9746 54.6581 20.4634C54.0714 21.4356 53.4272 22.3721 52.7288 23.268C51.3307 25.0679 49.7263 26.6987 47.9482 28.1273C47.5659 28.4427 47.1672 28.736 46.7681 29.0297C46.7066 29.075 46.645 29.1202 46.5835 29.1656C46.4171 29.2829 46.2481 29.3975 46.0788 29.5124C46.0112 29.5582 45.9436 29.6041 45.8762 29.6501C45.8356 29.6774 45.7951 29.7051 45.7546 29.7328C45.6771 29.786 45.5993 29.8393 45.5199 29.8898L45.1559 30.1167C44.1871 30.7275 43.1835 31.2818 42.1501 31.7766C40.7964 32.4172 39.4002 32.9645 37.9714 33.4148C36.2608 34.0211 33.9766 34.1492 32.4177 34.1364C30.639 34.121 29.1869 33.7288 27.7348 33.1328C26.249 32.5342 24.9207 31.6042 23.8519 30.4141C22.7389 29.1775 21.9922 27.6572 21.695 26.0226C21.5488 25.1871 21.5323 24.3341 21.6461 23.4936C21.7628 22.6449 22.0146 21.8201 22.3921 21.0505C23.1564 19.497 24.3964 18.2258 25.9329 17.4204C26.6992 17.0178 27.5236 16.7362 28.3766 16.586C28.8012 16.5115 29.2303 16.4708 29.6599 16.4639V20.0223C29.4233 20.0199 29.1864 20.0357 28.9515 20.0699C28.46 20.143 27.9828 20.2913 27.5368 20.5096C26.8584 20.8383 26.2688 21.324 25.817 21.926C25.3653 22.528 25.0646 23.229 24.94 23.9704C24.8568 24.4747 24.852 24.9888 24.9258 25.4945C25.0915 26.5499 25.5474 27.5389 26.2429 28.3516C26.9756 29.2096 27.8955 29.8892 28.9322 30.3384C30.0024 30.8073 31.155 31.0608 32.3238 31.0844H32.5952C34.8666 31.0768 38.2994 30.5115 40.055 29.0259C41.9139 27.4643 43.1222 25.2684 43.444 22.8668C43.6038 21.66 43.5485 20.4346 43.2807 19.247C43.0049 18.0431 42.5353 16.8917 41.8903 15.8374C41.236 14.7681 40.4289 13.7995 39.4942 12.9623C38.5488 12.1143 37.4969 11.3922 36.365 10.814C34.0574 9.64921 31.5123 9.02823 28.9258 8.99895C26.3134 8.96096 23.7225 9.47424 21.3233 10.5051C20.1197 11.0182 18.9735 11.6557 17.9034 12.4073C16.83 13.1626 15.8386 14.0273 14.9452 14.9875C13.1473 16.9207 11.7875 19.2166 10.9581 21.7196C10.1289 24.2379 9.84101 26.902 10.1131 29.5386C10.3913 32.1944 11.1831 34.7713 12.4449 37.1269C13.0735 38.3097 13.8052 39.4351 14.6314 40.4903C15.4624 41.5462 16.3791 42.5323 17.3722 43.4385C19.37 45.2625 21.6331 46.7751 24.0847 47.9248C26.5449 49.0821 29.1499 49.9047 31.83 50.3705C29.1262 49.9768 26.4878 49.2228 23.9857 48.1286C21.4721 47.0314 19.1393 45.5621 17.0661 43.7705C16.0279 42.8714 15.0652 41.8893 14.1877 40.8339C13.3089 39.7733 12.5252 38.638 11.8456 37.4409C10.4696 35.0326 9.57552 32.3811 9.21279 29.6334C8.85011 26.8637 9.07667 24.0489 9.87773 21.3722C10.6884 18.6798 12.0696 16.1922 13.9279 14.0775C15.8009 11.9464 18.103 10.2322 20.6846 9.04628C23.2661 7.86036 26.0693 7.22931 28.9117 7.19417C31.7916 7.1498 34.6432 7.76598 37.246 8.99511C39.8492 10.2372 42.1772 12.1522 43.781 14.635C44.5895 15.8808 45.1906 17.2486 45.561 18.6855C45.9314 20.1415 46.0407 21.6511 45.8839 23.1449C45.7676 24.2388 45.5037 25.3119 45.0993 26.3354C45.417 26.12 45.7321 25.9034 46.0369 25.6701C47.6851 24.4483 49.1842 23.0386 50.5038 21.4696C51.1662 20.6856 51.7813 19.8629 52.3456 19.006C52.6298 18.5779 52.887 18.1421 53.1443 17.6998C53.2677 17.4794 53.3886 17.2563 53.5031 17.0346L53.6484 16.7398C53.6411 16.7251 53.6337 16.7103 53.6262 16.6952C53.5996 16.6417 53.5718 16.5859 53.5417 16.5308C53.4002 16.2642 53.2356 15.9874 53.0632 15.7143C52.716 15.167 52.3327 14.6261 51.9301 14.0954C51.1167 13.0308 50.2383 12.0171 49.2999 11.0601C47.4151 9.12976 45.3099 7.42616 43.0273 5.98415C40.741 4.53867 38.2735 3.40001 35.6885 2.59762C33.0913 1.79762 30.3958 1.35894 27.6782 1.29403C27.3378 1.28122 27 1.2876 26.6609 1.294L26.6596 1.29403C26.5636 1.29584 26.4676 1.29632 26.3715 1.2968C26.1276 1.29802 25.8836 1.29924 25.6409 1.32223L24.6236 1.39144C24.4913 1.39744 24.3597 1.41433 24.2284 1.4312C24.1912 1.43598 24.154 1.44075 24.1168 1.44528L23.6101 1.50937C23.1271 1.55677 22.6507 1.64567 22.1742 1.73457C21.9808 1.77066 21.7873 1.80676 21.5934 1.84008C21.3861 1.88555 21.1792 1.93499 20.9726 1.98439C20.8472 2.01436 20.7219 2.04432 20.5966 2.07336C20.531 2.08959 20.4651 2.10501 20.3993 2.12043C20.2988 2.14398 20.1984 2.16751 20.0989 2.19385L19.6063 2.33742C18.2877 2.71423 16.9982 3.18546 15.7478 3.7474C14.4894 4.30262 13.2688 4.93933 12.0938 5.65344C11.4996 6.00081 10.926 6.37895 10.351 6.76349L9.50089 7.35953C9.31499 7.49065 9.13357 7.62792 8.95183 7.76543C8.8582 7.83628 8.76449 7.90719 8.67003 7.97736C7.5725 8.81138 6.51656 9.70053 5.50221 10.6448C4.48785 11.5891 3.51937 12.5782 2.59676 13.6122C2.13632 14.1287 1.68487 14.653 1.25144 15.1978C0.818 15.7425 0.393566 16.2924 0 16.8641C0.371701 16.2745 0.772984 15.7118 1.18713 15.1529C1.60127 14.594 2.03085 14.0493 2.47329 13.5122C3.35989 12.4406 4.29321 11.4105 5.27327 10.4218C6.25332 9.43306 7.28226 8.49307 8.36006 7.60179C8.44732 7.53131 8.53418 7.46017 8.62107 7.389C8.80441 7.23884 8.98788 7.08858 9.17549 6.94422L10.0102 6.30332C10.5787 5.8957 11.1459 5.49065 11.7362 5.10611C12.9085 4.33157 14.1299 3.63366 15.3928 3.01677C16.6569 2.39006 17.965 1.85543 19.3066 1.41708L19.8095 1.24916C19.9094 1.21965 20.0085 1.19226 20.107 1.16504C20.1796 1.14497 20.2519 1.12499 20.3239 1.10432C20.4603 1.06744 20.5957 1.02956 20.7307 0.991783C20.9382 0.933722 21.1448 0.875905 21.3529 0.822323C21.5484 0.780664 21.7437 0.736343 21.9391 0.691993C22.435 0.579414 22.9318 0.466649 23.4365 0.396764L23.9625 0.309601C24.0099 0.302315 24.0572 0.294465 24.1046 0.286611C24.2322 0.265449 24.36 0.244258 24.4885 0.233974L25.5496 0.119894C25.8774 0.0769762 26.2085 0.0639956 26.5388 0.0510463C26.5636 0.0500725 26.5885 0.0490989 26.6133 0.0481128C26.7379 0.043164 26.8628 0.0361626 26.9877 0.029159C27.2188 0.016208 27.45 0.00324968 27.6795 0.00324968C30.5327 -0.0379711 33.3779 0.313132 36.1348 1.04664C38.8996 1.78678 41.5544 2.88708 44.0305 4.31909C46.511 5.7544 48.8136 7.47528 50.8909 9.4463C51.9364 10.4328 52.9201 11.4824 53.8362 12.5893C54.2954 13.1482 54.7378 13.7224 55.1584 14.3313C55.368 14.6363 55.5725 14.9491 55.7706 15.2875C55.8696 15.4528 55.9661 15.6323 56.0639 15.8374C56.1204 15.9547 56.1706 16.0749 56.2143 16.1976C56.2486 16.2934 56.2761 16.3915 56.2966 16.4911C56.3025 16.5244 56.3077 16.5577 56.3127 16.5899C56.3142 16.5998 56.3157 16.6096 56.3172 16.6193C56.3249 16.6359 56.3249 16.6769 56.3249 16.7064Z"
            fill="white"
          />
        </svg>

        {!web3Store.disableScreen && (
          <div
            style={{ opacity: opacity ? 1 : 0, transition: "500ms ease all" }}
          >
            {timerEnd > 0 ? <Timer /> : <StepTitle />}
          </div>
        )}
      </div>
      <div
        style={{
          display: "flex",
          flexDirection: "column",
          alignItems: "center",
        }}
      >
        {timerEnd < 0 && (
          <button className={style.mint__button} onClick={openMintModal}>
            Mint
          </button>
        )}
        {"timeToMint: " + timeToMint}
        {"Date.parse(new Date().toString()): " + Date.parse(new Date().toString())}
        {"test:" + timerEnd}
        <div className={style.mint__text}>
          Hand drawn, Farcaster native collection focused on world building and
          immersive experience
        </div>
      </div>
    </div>
  );
});
export default Mint;
